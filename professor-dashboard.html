<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student VR Project Submissions</title>
  <style>
    :root { --blue:#0d6efd; --green:#198754; --yellow:#ffc107; --red:#dc3545; --muted:#6c757d; }
    *{ box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; color:#212529; }
    h1 { margin-bottom: 16px; font-size: 40px; font-weight: 800; }
    .container{ max-width: 980px; margin: 0 auto; }
    .card{ border:1px solid #e5e7eb; border-radius: 12px; padding: 18px; margin:16px 0; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .title{ font-size: 26px; font-weight: 800; margin:0 0 8px; }
    .meta{ color:#495057; margin:6px 0; }
    .host-row{ margin:8px 0; }
    .host-link{ color:#198754; font-weight: 800; text-decoration: none; }
    .btn{ display:inline-flex; align-items:center; gap:8px; background:#f8f9fa; border:1px solid #dee2e6; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; text-decoration:none; color:#212529; }
    .btn.blue{ background:#e7f1ff; border-color:#b6d4fe; color:#0d6efd; }
    .btn.yellow{ background:#fff3cd; border-color:#ffec99; color:#8a6d3b; }
    .btn.red{ background:#f8d7da; border-color:#f1aeb5; color:#842029; }
    .row{ display:flex; gap:12px; flex-wrap: wrap; }
    .upload { margin-top: 16px; border: 1px solid #e5e7eb; padding: 16px; border-radius: 12px; }
    .muted { color: var(--muted); font-size: 13px; }
    input[type="text"] { padding: 8px 10px; font-size: 14px; border:1px solid #dee2e6; border-radius:8px; }
    input[type="file"] { font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Student VR Project Submissions</h1>
    <div class="muted">Manage student submissions: upload, host, unhost, delete.</div>

    <div class="upload">
      <h3>Upload Student Project (ZIP)</h3>
      <form id="uploadForm">
        <div>
          <label>Student Name: <input type="text" name="studentName" required /></label>
        </div>
        <div>
          <label>Project Name: <input type="text" name="projectName" required /></label>
        </div>
        <div>
          <input type="file" name="project" accept=".zip" required />
        </div>
        <button class="btn" type="submit">Submit Project</button>
        <span id="uploadStatus" class="muted"></span>
      </form>
    </div>

    <div id="cards"></div>
  </div>

  <script>
    async function fetchSubmissions() {
      const res = await fetch('/professor/submissions');
      const data = await res.json();
      renderRows(data);
    }

    function renderRows(items) {
      const list = document.getElementById('cards');
      list.innerHTML = '';
      items.forEach((item) => {
        const hosted = !!item.isHosted;
        const hostedUrl = item.hostedUrl;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div class="title">${(item.projectName || '').replace(/_/g,' ')}</div>
          <div class="meta"><b>Student:</b> ${item.studentName || ''}</div>
          <div class="meta"><b>Submitted:</b> ${new Date(item.submittedAt).toLocaleString()}</div>
          <div class="meta"><b>File:</b> ${item.fileName}</div>
          <div class="host-row"><b>üåê Hosted at:</b> ${hosted && hostedUrl ? `<a class=\"host-link\" href=\"${hostedUrl}\" target=\"_blank\">${(item.hostedPath||'open').replace(/_/g,' ')}</a>` : '<span class=\"muted\">not hosted</span>'}</div>
          ${hosted && item.hostedAt ? `<div class=\"meta\"><b>Hosted on:</b> ${new Date(item.hostedAt).toLocaleString()}</div>` : ''}
          <div class="row" style="margin-top:12px">
            <a class="btn blue" href="/professor/download/${item.fileName}">‚¨áÔ∏è Download</a>
            <button class="btn yellow" onclick="unhost('${item.fileName}')">üîó Unhost</button>
            <button class="btn red" onclick="del('${item.fileName}')">üóëÔ∏è Delete</button>
          </div>
          <div class="row" style="margin-top:10px">
            <input type="text" placeholder="url-path" value="${(item.studentName || 'student').replace(/[^a-zA-Z0-9_-]/g,'_')}" id="url-${item.fileName}">
            <button class="btn" onclick="host('${item.fileName}')">üåê Host</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    async function host(filename) {
      const input = document.getElementById(`url-${filename}`);
      const urlPath = input.value.trim();
      await fetch(`/professor/host/${filename}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ urlPath })
      });
      await fetchSubmissions();
    }

    async function unhost(filename) {
      await fetch(`/professor/unhost/${filename}`, { method: 'POST' });
      await fetchSubmissions();
    }

    async function del(filename) {
      await fetch(`/professor/delete/${filename}`, { method: 'DELETE' });
      await fetchSubmissions();
    }

    const form = document.getElementById('uploadForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const res = await fetch('/submit-project', { method: 'POST', body: fd });
      document.getElementById('uploadStatus').textContent = res.ok ? 'Uploaded!' : 'Upload failed';
      form.reset();
      await fetchSubmissions();
    });

    fetchSubmissions();
  </script>
</body>
</html>
